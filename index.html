
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üóìÔ∏è</text></svg>">
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@^0.15.0",
        "marked": "https://esm.sh/marked@^15.0.8"
      }
    }
  </script>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div class="header-title">
        <span class="material-symbols-outlined header-logo">calendar_month</span>
        <h1>–ö–∞–ª–µ–Ω–¥–∞—Ä—å-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>
      </div>
      <div class="header-actions">
        <div id="user-profile" style="display: none;">
          <img id="user-avatar" src="" alt="User Avatar">
          <span id="user-name"></span>
        </div>
        <button id="settings-button" class="icon-button" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
          <span class="material-symbols-outlined">settings</span>
        </button>
      </div>
    </header>

    <main class="main-content">
      <div class="chat-panel">
        <div id="message-list" role="log" aria-live="polite">
          <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
        </div>

        <div id="welcome-screen">
          <h2 id="welcome-greeting">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!</h2>
          <p id="welcome-subheading" class="welcome-subheading">–ù–∞—á–Ω–∏—Ç–µ —Å –≤–≤–æ–¥–∞ –∫–ª—é—á–µ–π API –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
          <div id="suggestion-chips-container" style="display: none;">
            <button class="suggestion-chip">–°–æ–∑–¥–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É –Ω–∞ –∑–∞–≤—Ç—Ä–∞</button>
            <button class="suggestion-chip">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–æ–∫</button>
            <button class="suggestion-chip">–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞?</button>
          </div>
        </div>

        <div id="loading-indicator" style="display: none;" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞">
          <div class="spinner"></div>
          <span>–û–±—Ä–∞–±–æ—Ç–∫–∞...</span>
        </div>
        
        <div class="chat-input-container">
          <div id="chat-reply-context" style="display: none;">
             <p id="chat-reply-context-text"></p>
             <button id="chat-reply-context-close" aria-label="–û—Ç–º–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç">
                 <span class="material-symbols-outlined">close</span>
             </button>
          </div>
          <div id="chat-input-bar">
            <div class="camera-button-container">
              <button id="camera-button-chat" class="input-bar-button" aria-label="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                <span class="material-symbols-outlined">add_photo_alternate</span>
              </button>
              <div id="camera-options-menu" class="camera-options-menu" style="display: none;">
                <button id="take-photo-option" aria-label="–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>
                <button id="upload-photo-option" aria-label="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
              </div>
            </div>
            <input type="file" id="image-upload-input-chat" accept="image/*" style="display: none;">
            <textarea id="chat-text-input" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å..." aria-label="–¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ –¥–ª—è —á–∞—Ç–∞" rows="1"></textarea>
            <button id="mic-button-chat" class="input-bar-button" aria-label="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">
              <span class="material-symbols-outlined">mic</span>
            </button>
          </div>
        </div>
      </div>

      <aside class="calendar-panel">
          <div id="calendar-login-prompt">
            <p>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à –∫–∞–ª–µ–Ω–¥–∞—Ä—å.</p>
          </div>
          <div id="calendar-view-container" style="display: none;">
              <div id="calendar-container">
                  <div class="calendar-header">
                      <h2 id="current-month-year"></h2>
                      <div class="calendar-controls">
                        <button id="prev-month-button" class="icon-button" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü">
                            <span class="material-symbols-outlined">chevron_left</span>
                        </button>
                        <button id="today-button" class="action-button">–°–µ–≥–æ–¥–Ω—è</button>
                        <button id="next-month-button" class="icon-button" aria-label="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü">
                            <span class="material-symbols-outlined">chevron_right</span>
                        </button>
                      </div>
                  </div>
                  <div class="calendar-grid" id="calendar-grid-weekdays"></div>
                  <div class="calendar-grid" id="calendar-grid-days"></div>
              </div>
              <div id="daily-events-container">
                  <h3 id="daily-events-header"></h3>
                  <ul id="daily-events-list">
                      <!-- –°–æ–±—ã—Ç–∏—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å -->
                  </ul>
              </div>
          </div>
      </aside>
    </main>
  </div>
  
  <div id="camera-modal" class="modal" style="display:none;" aria-hidden="true">
    <div class="modal-content">
      <video id="camera-stream" width="320" height="240" autoplay playsinline aria-label="–í–∏–¥–µ–æ–ø–æ—Ç–æ–∫ —Å –∫–∞–º–µ—Ä—ã"></video>
      <button id="capture-photo-button" class="action-button primary" aria-label="–°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫">–°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫</button>
      <button id="cancel-camera-button" class="action-button" aria-label="–û—Ç–º–µ–Ω–∏—Ç—å —Å—ä–µ–º–∫—É">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <div id="settings-modal" class="modal" style="display:none;" aria-hidden="true">
      <div class="modal-content settings-modal-content">
          <button id="close-settings-button" class="icon-button close-modal-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏">
              <span class="material-symbols-outlined">close</span>
          </button>
          <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
          <div id="settings-user-profile" style="display: none;">
              <img id="settings-user-avatar" src="" alt="User Avatar">
              <div id="settings-user-info">
                  <span id="settings-user-name"></span>
                  <span id="settings-user-email"></span>
              </div>
          </div>
          <h4>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google</h4>
          <div id="auth-container-settings">
            <!-- Auth buttons will be dynamically added here for settings -->
          </div>
          <button id="sign-out-button" class="action-button" style="display: none;">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>

          <h4>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API-–∫–ª—é—á–∞–º–∏</h4>
          <div class="form-field">
            <label for="settings-gemini-api-key">Gemini API Key</label>
            <input type="password" id="settings-gemini-api-key" placeholder="–í–∞—à Gemini API Key">
            <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">–ü–æ–ª—É—á–∏—Ç—å API Key</a>
          </div>
          <div class="form-field">
            <label for="settings-google-client-id">Google Client ID</label>
            <input type="password" id="settings-google-client-id" placeholder="–í–∞—à Google Client ID">
             <a href="#" class="open-client-id-instructions">–ü–æ–ª—É—á–∏—Ç—å Client ID</a>
          </div>
          <button id="save-api-keys-button" class="action-button primary" style="width: 100%; justify-content: center; margin-top: 10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á–∏</button>
      </div>
  </div>
  
  <div id="google-client-id-instructions-modal" class="modal" style="display:none;" aria-hidden="true">
    <div class="modal-content instructions-modal-content">
      <button id="close-instructions-button" class="icon-button close-modal-button" aria-label="–ó–∞–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é">
        <span class="material-symbols-outlined">close</span>
      </button>
      <h2>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Google Client ID</h2>
      <p>–°–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º —à–∞–≥–∞–º, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å Client ID –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º Google.</p>
      
      <div class="instructions-body">
        <ol>
          <li>
            <strong>–û—Ç–∫—Ä–æ–π—Ç–µ Google Cloud Console.</strong>
            <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç Google.</p>
            <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener noreferrer" class="action-button primary">
              –ü–µ—Ä–µ–π—Ç–∏ –≤ Google Cloud Console
              <span class="material-symbols-outlined">open_in_new</span>
            </a>
          </li>
          <li>
            <strong>–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç.</strong>
            <p>–í –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π.</p>
          </li>
          <li>
            <strong>–í–∫–ª—é—á–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ API.</strong>
            <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <a href="https://console.cloud.google.com/apis/library" target="_blank" rel="noopener noreferrer">"–ë–∏–±–ª–∏–æ—Ç–µ–∫—É API"</a>, –Ω–∞–π–¥–∏—Ç–µ –∏ –≤–∫–ª—é—á–∏—Ç–µ (–Ω–∞–∂–º–∏—Ç–µ "Enable") **–∫–∞–∂–¥—ã–π** –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö API:</p>
            <ul>
                <li><strong>Google Calendar API</strong></li>
                <li><strong>People API</strong></li>
                <li><strong>Google Tasks API</strong></li>
                <li><strong>Google Docs API</strong></li>
            </ul>
          </li>
          <li>
            <strong>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —ç–∫—Ä–∞–Ω —Å–æ–≥–ª–∞—Å–∏—è OAuth.</strong>
            <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>"OAuth consent screen"</strong>.
              <br>- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø <strong>"External"</strong> –∏ –Ω–∞–∂–º–∏—Ç–µ "Create".
              <br>- –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–∞–ª–µ–Ω–¥–∞—Ä—å-–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç"), –≤–∞—à email, –∏ –Ω–∞–∂–º–∏—Ç–µ <strong>"Save and Continue"</strong> –¥–æ –∫–æ–Ω—Ü–∞.
              <br>- –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É OAuth consent screen –∏ –Ω–∞–∂–º–∏—Ç–µ <strong>"Publish App"</strong>.
            </p>
          </li>
          <li>
            <strong>–°–æ–∑–¥–∞–π—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</strong>
            <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>"Credentials"</strong>, –Ω–∞–∂–º–∏—Ç–µ <strong>"+ CREATE CREDENTIALS"</strong> –∏ –≤—ã–±–µ—Ä–∏—Ç–µ <strong>"OAuth client ID"</strong>.</p>
          </li>
          <li>
            <strong>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Client ID.</strong>
            <p>–≠—Ç–æ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —à–∞–≥. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∞–¥—Ä–µ—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã —Ç–æ—á–Ω–æ.</p>
            <p>- –í "Application type" –≤—ã–±–µ—Ä–∏—Ç–µ <strong>"Web application"</strong>.
            <br>- –í —Ä–∞–∑–¥–µ–ª–µ <strong>"Authorized JavaScript origins"</strong>, –Ω–∞–∂–º–∏—Ç–µ "+ ADD URI" –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å:</p>
            <div class="uri-container">
              <code id="instructions-js-origin"></code>
              <button class="copy-uri-button" data-target="instructions-js-origin" aria-label="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URI">
                  <span class="material-symbols-outlined">content_copy</span>
              </button>
            </div>
            
            <p>- –í —Ä–∞–∑–¥–µ–ª–µ <strong>"Authorized redirect URIs"</strong>, –Ω–∞–∂–º–∏—Ç–µ "+ ADD URI" –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –∞–¥—Ä–µ—Å:</p>
            <div class="uri-container">
                <code id="instructions-redirect-uri"></code>
                <button class="copy-uri-button" data-target="instructions-redirect-uri" aria-label="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è">
                    <span class="material-symbols-outlined">content_copy</span>
                </button>
            </div>
            
            <p>- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>"CREATE"</strong>.</p>
          </li>
           <li>
            <strong>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à Client ID.</strong>
            <p>–í –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤–∞—à <strong>Client ID</strong>. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.</p>
          </li>
        </ol>

        <div class="instructions-troubleshooting">
            <div class="troubleshooting-header">
                <span class="material-symbols-outlined">report_problem</span>
                <h4>–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º: –û—à–∏–±–∫–∞ 400: invalid_request</h4>
            </div>
            <p>–≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ URI –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Google –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –∞–¥—Ä–µ—Å–æ–º –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã **–≤ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏** –∞–¥—Ä–µ—Å–∞ –∏–∑ —à–∞–≥–∞ 6 —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–æ–∫ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å". –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, –≤—Ä–æ–¥–µ `/` –≤ –∫–æ–Ω—Ü–µ.</p>
        </div>

      </div>
    </div>
  </div>


  <!-- Create global callbacks that dispatch events for the module to hear -->
  <script>
    function onGapiLoad() { window.gapiLoadedCallback && window.gapiLoadedCallback(); }
    function onGisLoad() { window.gisInitalisedCallback && window.gisInitalisedCallback(); }
  </script>
  
  <!-- Statically load Google API scripts. The onload callbacks will trigger initialization. -->
  <script async defer src="https://apis.google.com/js/api.js" onload="onGapiLoad()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="onGisLoad()"></script>
  
  <script type="module" src="index.js"></script>
</body>
</html>
